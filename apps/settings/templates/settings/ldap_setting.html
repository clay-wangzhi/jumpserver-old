{% extends 'base.html' %}
{% load static %}
{% load bootstrap3 %}
{% load i18n %}
{% load common_tags %}

{% block content %}
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="row">
            <div class="col-sm-12">
                <div class="ibox float-e-margins">
                    <div class="panel-options">
                        {% include 'settings/_setting_tabs.html' %}
                    </div>
                    <div class="tab-content">
                        <div class="col-sm-12" style="padding-left:0">
                                <div class="ibox-content" style="border-width: 0;padding-top: 40px;">
                                    <form id="ldap_form" action="" method="post" class="form-horizontal">
                                    {% if form.non_field_errors %}
                                         <div class="alert alert-danger">
                                             {{ form.non_field_errors }}
                                         </div>
                                    {% endif %}
                                    {% csrf_token %}
                                    {% for field in form %}
                                        {% if not field.field|is_bool_field %}
                                            {% bootstrap_field field layout="horizontal" %}
                                        {% else %}
                                            <div class="form-group">
                                                <label for="{{ field.id_for_label }}" class="col-sm-2 control-label">{{ field.label }}</label>
                                                <div class="col-sm-8">
                                                    <div class="col-sm-1">
                                                        {{ field }}
                                                    </div>
                                                    <div class="col-sm-9">
                                                        <span class="help-block" >{{ field.help_text }}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                    <div class="hr-line-dashed"></div>
                                    <div class="form-group">
                                        <div class="col-sm-9 col-sm-offset-2">
                                            <button class="btn btn-default" type="reset"> {% trans 'Reset' %}</button>
                                            <button class="btn btn-default btn-test-config" type="button"> {% trans 'Test connection' %}</button>
                                            <button class="btn btn-default btn-test-login" type="button"> {% trans 'Test login' %}</button>
                                            <button class="btn btn-default sync_button " data-toggle="modal" data-target="#ldap_list_users_modal" type="button">{% trans 'Bulk import' %}</button>
                                            <button id="submit_button" class="btn btn-primary" type="submit">{% trans 'Submit' %}</button>
                                        </div>
                                    </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% include 'settings/_ldap_list_users_modal.html' %}
    {% include 'settings/_ldap_test_user_login_modal.html' %}
{% endblock %}
{% block custom_foot_js %}
<script>
$(document).ready(function () {

})
.on("click", ".btn-test-config", function () {
    var data = {};
    var form = $("form").serializeArray();
    $.each(form, function (i, field) {
        data[field.name] = field.value;
    });

    var the_url = "{% url 'api-settings:ldap-testing-config' %}";

    function error(message) {
        toastr.error(message)
    }

    function success(message) {
        toastr.success(message)
    }
    requestApi({
        url: the_url,
        body: JSON.stringify(data),
        method: "POST",
        flash_message: false,
        success: success,
        error: error
    });
})
.on("click", ".btn-test-login", function () {
    $('#test_user_login_modal').modal('show')

})
</script>
{% endblock %}
